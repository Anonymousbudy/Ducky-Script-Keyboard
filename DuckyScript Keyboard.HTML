<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Ducky Script Generator</title>
    <!-- PWA configuration links -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://placehold.co/192x192/424242/E0E0E0?text=D">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #121212;
            color: #E0E0E0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }
        .container {
            width: 100%;
            max-width: 650px;
            padding: 1.5rem;
            background-color: #1E1E1E;
            border-radius: 1.5rem;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            position: relative;
        }
        .settings-btn {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #E0E0E0;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        .settings-btn:hover {
            transform: rotate(45deg);
        }
        .output-container {
            position: relative;
        }
        #output {
            width: 100%;
            height: 150px;
            padding: 1rem;
            background-color: #2D2D2D;
            border-radius: 1rem;
            border: 1px solid #444;
            color: #E0E0E0;
            font-family: monospace;
            resize: none;
            outline: none;
        }
        #output::placeholder {
            color: #888;
        }
        .keyboard {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .key-row {
            display: flex;
            gap: 0.5rem;
            justify-content: space-between;
        }
        .key {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 0;
            background-color: #424242;
            border-radius: 0.75rem;
            font-weight: 500;
            color: #E0E0E0;
            transition: background-color 0.1s ease, transform 0.1s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            cursor: pointer;
            user-select: none;
            position: relative;
            text-align: center;
        }
        .key:active {
            background-color: #555;
            transform: scale(0.98);
        }
        .key-wide { flex: 1.5; }
        .key-space { flex: 4; }
        .key-enter { flex: 2; }
        .key-main { font-size: 1.25rem; line-height: 1; }
        .key-info { font-size: 0.75rem; opacity: 0.7; line-height: 1; }
        .key-mod { background-color: #007aff; }
        .key-mod:active { background-color: #005bb5; }
        .key-mod.active {
            background-color: #50BFFF;
        }
        .key-action {
            background-color: #3b82f6; /* Blue like the copy button */
            transition: background-color 0.2s ease, transform 0.1s ease;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            border-radius: 0.75rem;
            padding: 0.75rem;
            color: white;
            flex: 1;
            text-align: center;
            cursor: pointer;
        }
        .key-action:active {
            background-color: #2563eb;
            transform: scale(0.98);
        }
        .key-input {
            width: 100%;
            height: 100%;
            padding: 0.5rem;
            background-color: #2D2D2D;
            border-radius: 0.75rem;
            color: #E0E0E0;
            border: none;
            text-align: center;
            font-weight: 500;
            outline: none;
        }
        .key-input::placeholder { color: #888; }
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex; justify-content: center; align-items: center; z-index: 100;
        }
        .modal-content {
            background-color: #1E1E1E; padding: 2rem; border-radius: 1.5rem;
            width: 90%; max-width: 400px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            display: flex; flex-direction: column; gap: 1rem;
        }
        .modal-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem; text-align: center; }
        .modal-key-row {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem;
        }
        .modal-key {
            width: 100%; padding: 0.75rem; background-color: #424242; border-radius: 0.75rem;
            font-weight: 500; color: #E0E0E0; transition: background-color 0.1s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3); cursor: pointer; text-align: center;
        }
        .modal-key:active { background-color: #555; }
        .clear-copy-row { display: flex; gap: 0.5rem; }
        .clear-copy-row button {
            flex-grow: 1; padding: 0.75rem; border-radius: 0.75rem;
            font-weight: 700; color: white; transition: background-color 0.2s;
        }
        .clear-copy-row #clear-btn { background-color: #ef4444; }
        .clear-copy-row #copy-btn { background-color: #3b82f6; }
        .clear-copy-row #clear-btn:hover { background-color: #dc2626; }
        .clear-copy-row #copy-btn:hover { background-color: #2563eb; }
        #message-box {
            position: fixed; top: 1rem; right: 1rem; background-color: #10B981;
            color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 200;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 flex flex-col items-center justify-center p-4 min-h-screen">
    <div class="container">
        <!-- Settings Button -->
        <button id="settings-btn" class="settings-btn">⚙️</button>

        <!-- Title and Output -->
        <h1 class="text-3xl font-bold text-center">Ducky Script Generator</h1>
        <div class="output-container">
            <textarea id="output" readonly placeholder="Your script will appear here..."></textarea>
        </div>

        <!-- Main Keyboard -->
        <div class="keyboard">
            <!-- Row 1: Numbers -->
            <div class="key-row">
                <button class="key" data-key="1">1</button>
                <button class="key" data-key="2">2</button>
                <button class="key" data-key="3">3</button>
                <button class="key" data-key="4">4</button>
                <button class="key" data-key="5">5</button>
                <button class="key" data-key="6">6</button>
                <button class="key" data-key="7">7</button>
                <button class="key" data-key="8">8</button>
                <button class="key" data-key="9">9</button>
                <button class="key" data-key="0">0</button>
            </div>
            
            <!-- Row 2: QWERTY -->
            <div class="key-row">
                <button class="key letter-key" data-key="Q">q</button>
                <button class="key letter-key" data-key="W">w</button>
                <button class="key letter-key" data-key="E">e</button>
                <button class="key letter-key" data-key="R">r</button>
                <button class="key letter-key" data-key="T">t</button>
                <button class="key letter-key" data-key="Y">y</button>
                <button class="key letter-key" data-key="U">u</button>
                <button class="key letter-key" data-key="I">i</button>
                <button class="key letter-key" data-key="O">o</button>
                <button class="key letter-key" data-key="P">p</button>
            </div>

            <!-- Row 3: ASDF -->
            <div class="key-row">
                <button class="key letter-key" data-key="A">a</button>
                <button class="key letter-key" data-key="S">s</button>
                <button class="key letter-key" data-key="D">d</button>
                <button class="key letter-key" data-key="F">f</button>
                <button class="key letter-key" data-key="G">g</button>
                <button class="key letter-key" data-key="H">h</button>
                <button class="key letter-key" data-key="J">j</button>
                <button class="key letter-key" data-key="K">k</button>
                <button class="key letter-key" data-key="L">l</button>
            </div>

            <!-- Row 4: ZXCV -->
            <div class="key-row">
                <button id="shift-key" class="key key-mod" data-mod="SHIFT">SHIFT</button>
                <button id="caps-lock-key" class="key key-mod" data-mod="CAPS_LOCK">CAPS LOCK</button>
                <button class="key letter-key" data-key="Z">z</button>
                <button class="key letter-key" data-key="X">x</button>
                <button class="key letter-key" data-key="C">c</button>
                <button class="key letter-key" data-key="V">v</button>
                <button class="key letter-key" data-key="B">b</button>
                <button class="key letter-key" data-key="N">n</button>
                <button class="key letter-key" data-key="M">m</button>
                <button class="key" data-key=".">.</button>
                <button class="key" data-key=",">,</button>
            </div>

            <!-- Row 5: Modifiers & Space -->
            <div class="key-row">
                <button id="ctrl-key" class="key key-mod" data-mod="CTRL">CTRL</button>
                <button id="alt-key" class="key key-mod" data-mod="ALT">ALT</button>
                <button id="gui-key" class="key key-mod" data-mod="GUI">GUI</button>
                <button class="key key-space" data-key="SPACE">SPACE</button>
                <button class="key" data-key="ENTER">ENTER</button>
                <button class="key" data-key="TAB">TAB</button>
            </div>

            <!-- New Section for Punctuation & Symbols -->
            <h2 class="text-xl font-bold mt-4 text-center">Punctuation & Symbols</h2>
            <div class="key-row flex-wrap">
                <button class="key" data-key="!">!</button>
                <button class="key" data-key="@">@</button>
                <button class="key" data-key="#">#</button>
                <button class="key" data-key="$">$</button>
                <button class="key" data-key="%">%</button>
                <button class="key" data-key="^">^</button>
                <button class="key" data-key="&">&</button>
                <button class="key" data-key="*">*</button>
                <button class="key" data-key="(">(</button>
                <button class="key" data-key=")">)</button>
                <button class="key" data-key="-">-</button>
                <button class="key" data-key="_">_</button>
                <button class="key" data-key="=">=</button>
                <button class="key" data-key="+">+</button>
                <button class="key" data-key="`">`</button>
                <button class="key" data-key="~">~</button>
                <button class="key" data-key="\">&#92;</button>
                <button class="key" data-key="|">|</button>
                <button class="key" data-key="[">[</button>
                <button class="key" data-key="]">]</button>
                <button class="key" data-key="{">{</button>
                <button class="key" data-key="}">}</button>
                <button class="key" data-key=";">;</button>
                <button class="key" data-key=":">:</button>
                <button class="key" data-key="'">'</button>
                <button class="key" data-key="&quot;">"</button>
                <button class="key" data-key="<"><</button>
                <button class="key" data-key=">">></button>
                <button class="key" data-key="/">/</button>
                <button class="key" data-key="?">?</button>
            </div>
            
            <!-- Function Keys -->
            <h2 class="text-xl font-bold mt-4 text-center">Function Keys</h2>
            <div class="key-row flex-wrap mt-2">
                <button class="key" data-key="F1">F1</button>
                <button class="key" data-key="F2">F2</button>
                <button class="key" data-key="F3">F3</button>
                <button class="key" data-key="F4">F4</button>
                <button class="key" data-key="F5">F5</button>
                <button class="key" data-key="F6">F6</button>
                <button class="key" data-key="F7">F7</button>
                <button class="key" data-key="F8">F8</button>
                <button class="key" data-key="F9">F9</button>
                <button class="key" data-key="F10">F10</button>
                <button class="key" data-key="F11">F11</button>
                <button class="key" data-key="F12">F12</button>
            </div>

            <!-- Row 7: Navigation & Backspace -->
            <div class="key-row">
                <button class="key" data-key="BACKSPACE">BACKSPACE</button>
                <button class="key" data-key="DELETE">DELETE</button>
                <button class="key" data-key="HOME">HOME</button>
                <button class="key" data-key="END">END</button>
                <button class="key" data-key="UP_ARROW">▲</button>
                <button class="key" data-key="DOWN_ARROW">▼</button>
                <button class="key" data-key="LEFT_ARROW">◀</button>
                <button class="key" data-key="RIGHT_ARROW">▶</button>
            </div>

            <!-- Row 8: Commands and Inputs -->
            <div class="key-row mt-2">
                <button id="add-string-btn" class="key-action">STRING</button>
                <button id="add-delay-btn" class="key-action">DELAY</button>
            </div>
            
            <div class="key-row gap-2 mt-1">
                <input type="text" id="string-input" class="key-input" placeholder="Enter text here">
                <input type="number" id="delay-input" class="key-input" placeholder="Delay (ms)..." value="100">
            </div>

            <div class="key-row">
                <button id="add-combo-btn" class="key key-mod">COMBINATIONS</button>
                <button id="add-media-btn" class="key key-mod">MEDIA KEYS</button>
            </div>
            
            <!-- New row for custom keys -->
            <div id="custom-keys-row" class="key-row flex-wrap mt-2">
                <!-- Custom keys will be added here dynamically -->
            </div>
        </div>

        <div class="clear-copy-row">
            <button id="clear-btn">Clear</button>
            <button id="copy-btn">Copy</button>
        </div>

        <div id="message-box" class="hidden">
            Copied to clipboard!
        </div>
    </div>
    
    <!-- Modals for less common keys -->
    <div id="combo-modal" class="modal hidden">
        <div class="modal-content">
            <h2 class="modal-title">Common Combinations</h2>
            <div class="modal-key-row">
                <button class="modal-key" data-key="ALT F4">ALT F4</button>
                <button class="modal-key" data-key="CTRL C">CTRL C</button>
                <button class="modal-key" data-key="CTRL V">CTRL V</button>
                <button class="modal-key" data-key="CTRL Z">CTRL Z</button>
                <button class="modal-key" data-key="CTRL SHIFT ESC">CTRL SHIFT ESC</button>
                <button class="modal-key" data-key="CTRL ALT DEL">CTRL ALT DEL</button>
                <button class="modal-key" data-key="GUI R">GUI R</button>
                <button class="modal-key" data-key="GUI L">GUI L</button>
                <button class="modal-key" data-key="CTRL A">CTRL A</button>
                <button class="modal-key" data-key="CTRL F4">CTRL F4</button>
                <button class="modal-key" data-key="ALT TAB">ALT TAB</button>
            </div>
        </div>
    </div>

    <div id="media-modal" class="modal hidden">
        <div class="modal-content">
            <h2 class="modal-title">Media & System Keys</h2>
            <div class="modal-key-row">
                <button class="modal-key" data-key="VOLUME_UP">VOLUME UP</button>
                <button class="modal-key" data-key="VOLUME_DOWN">VOLUME DOWN</button>
                <button class="modal-key" data-key="MUTE">MUTE</button>
                <button class="modal-key" data-key="PLAY_PAUSE">PLAY/PAUSE</button>
                <button class="modal-key" data-key="MEDIA_NEXT">MEDIA NEXT</button>
                <button class="modal-key" data-key="MEDIA_PREV">MEDIA PREV</button>
                <button class="modal-key" data-key="MEDIA_STOP">MEDIA STOP</button>
                <button class="modal-key" data-key="INSERT">INSERT</button>
                <button class="modal-key" data-key="PRINT_SCREEN">PRINT SCREEN</button>
                <button class="modal-key" data-key="SCROLL_LOCK">SCROLL LOCK</button>
                <button class="modal-key" data-key="PAUSE">PAUSE/BREAK</button>
            </div>
        </div>
    </div>

    <!-- New Settings Modal -->
    <div id="settings-modal" class="modal hidden">
        <div class="modal-content">
            <h2 class="modal-title">Manual Key Mapping</h2>
            <p class="text-sm opacity-80 -mt-4 mb-2">Create a new button with a custom Ducky Script command.</p>
            <input type="text" id="custom-key-name" class="key-input" placeholder="Button Name (e.g., 'Google')">
            <input type="text" id="custom-command" class="key-input" placeholder="Ducky Command (e.g., 'STRING https://google.com')">
            <button id="add-custom-key-btn" class="key-mod">Add Custom Key</button>
            <button id="close-settings-modal" class="key-mod" style="background-color: #ef4444; margin-top: 10px;">Close</button>
        </div>
    </div>
    
    <script>
        // PWA service worker registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js').then(registration => {
                    console.log('Service Worker registered with scope:', registration.scope);
                }).catch(err => {
                    console.log('Service Worker registration failed:', err);
                });
            });
        }
        
        const outputEl = document.getElementById('output');
        const copyBtn = document.getElementById('copy-btn');
        const clearBtn = document.getElementById('clear-btn');
        const messageBox = document.getElementById('message-box');
        const addStringBtn = document.getElementById('add-string-btn');
        const addDelayBtn = document.getElementById('add-delay-btn');
        const addComboBtn = document.getElementById('add-combo-btn');
        const addMediaBtn = document.getElementById('add-media-btn');
        const stringInput = document.getElementById('string-input');
        const delayInput = document.getElementById('delay-input');
        const comboModal = document.getElementById('combo-modal');
        const mediaModal = document.getElementById('media-modal');
        const settingsBtn = document.getElementById('settings-btn');
        const settingsModal = document.getElementById('settings-modal');
        const closeSettingsModalBtn = document.getElementById('close-settings-modal');
        const addCustomKeyBtn = document.getElementById('add-custom-key-btn');
        const customKeyNameInput = document.getElementById('custom-key-name');
        const customCommandInput = document.getElementById('custom-command');
        const customKeysRow = document.getElementById('custom-keys-row');
        const capsLockKey = document.getElementById('caps-lock-key');
        const letterKeys = document.querySelectorAll('.letter-key');
        
        let activeModifiers = new Set();
        let isCapsLockOn = false;

        const MODIFIER_KEYS = ['CTRL', 'ALT', 'GUI', 'SHIFT', 'CAPS_LOCK'];

        // Function to update the display of letter keys based on Caps Lock state
        function updateLetterKeysDisplay() {
            const isUpperCase = activeModifiers.has('SHIFT') !== activeModifiers.has('CAPS_LOCK');
            letterKeys.forEach(key => {
                const letter = key.dataset.key;
                if (isUpperCase) {
                    key.textContent = letter.toUpperCase();
                } else {
                    key.textContent = letter.toLowerCase();
                }
            });
        }

        // Function to get the correct Ducky Script command for a key click
        function getDuckyCommand(keyElement) {
            const baseKey = keyElement.dataset.key;
            if (!baseKey) return null;
            
            // Handle combination keys from modals directly.
            if (baseKey.includes(' ') || baseKey.includes('_')) {
                return baseKey.toUpperCase();
            }

            const directCommands = [
                'TAB', 'SPACE', 'ENTER', 'BACKSPACE', 'DELETE', 'HOME', 'END', 'UP_ARROW', 'DOWN_ARROW',
                'LEFT_ARROW', 'RIGHT_ARROW', 'F1', 'F2', 'F3', 'F4', 'F5', 'F6', 'F7', 'F8', 'F9', 'F10',
                'F11', 'F12', 'VOLUME_UP', 'VOLUME_DOWN', 'MUTE', 'PLAY_PAUSE', 'MEDIA_NEXT', 'MEDIA_PREV',
                'MEDIA_STOP', 'INSERT', 'PRINT_SCREEN', 'SCROLL_LOCK', 'PAUSE'
            ];

            let modifiers = Array.from(activeModifiers).filter(mod => mod !== 'CAPS_LOCK');

            // If a modifier is active, form the combination command.
            if (modifiers.length > 0) {
                // Key should be uppercase in the combination command.
                return `${modifiers.join(' ')} ${baseKey.toUpperCase()}`.trim();
            }

            // No modifiers active. Handle direct commands or STRING.
            if (directCommands.includes(baseKey.toUpperCase())) {
                return baseKey.toUpperCase();
            }

            // It's a character key, so use STRING.
            let character = baseKey;
            // Respect CAPS_LOCK and SHIFT for case.
            if (baseKey.length === 1 && baseKey.match(/[a-z]/i)) {
                let isUpperCase = activeModifiers.has('SHIFT') !== activeModifiers.has('CAPS_LOCK');
                character = isUpperCase ? baseKey.toUpperCase() : baseKey.toLowerCase();
            }
            
            return `STRING ${character}`;
        }


        // Function to append a command to the output area
        function appendToOutput(command) {
            if (outputEl.value) {
                outputEl.value += '\n';
            }
            outputEl.value += command;
        }

        // Handle a click on a key button
        function handleKeyClick(event) {
            const keyElement = event.target.closest('.key, .modal-key');
            if (!keyElement || (!keyElement.dataset.key && !keyElement.dataset.mod)) {
                return;
            }

            const keyType = keyElement.dataset.mod || keyElement.dataset.key;
            const isModifier = MODIFIER_KEYS.includes(keyType);

            if (isModifier) {
                keyElement.classList.toggle('active');
                if (keyElement.classList.contains('active')) {
                    activeModifiers.add(keyType);
                } else {
                    activeModifiers.delete(keyType);
                }
                updateLetterKeysDisplay();
                return;
            }

            const duckyCommand = getDuckyCommand(keyElement);
            if (duckyCommand) {
                appendToOutput(duckyCommand);
                // Clear all modifiers except CAPS_LOCK after a command is generated.
                activeModifiers.forEach(mod => {
                    if (mod !== 'CAPS_LOCK') {
                        activeModifiers.delete(mod);
                        document.querySelector(`[data-mod="${mod}"]`).classList.remove('active');
                    }
                });
                
                updateLetterKeysDisplay();
            }
        }
        
        document.querySelectorAll('.key').forEach(key => {
            key.addEventListener('click', handleKeyClick);
        });

        // Event listener for STRING button
        addStringBtn.addEventListener('click', () => {
            const stringValue = stringInput.value;
            if (stringValue) {
                appendToOutput(`STRING ${stringValue}`);
                stringInput.value = '';
            }
        });

        // Event listener for DELAY button
        addDelayBtn.addEventListener('click', () => {
            const delayValue = delayInput.value;
            if (delayValue) {
                appendToOutput(`DELAY ${delayValue}`);
            }
        });

        // Event listener for modal buttons
        addComboBtn.addEventListener('click', () => { comboModal.classList.remove('hidden'); });
        addMediaBtn.addEventListener('click', () => { mediaModal.classList.remove('hidden'); });
        settingsBtn.addEventListener('click', () => { settingsModal.classList.remove('hidden'); });
        closeSettingsModalBtn.addEventListener('click', () => { settingsModal.classList.add('hidden'); });

        // Add event listeners to the modal keys
        document.querySelectorAll('.modal-key').forEach(key => {
            key.addEventListener('click', (event) => {
                const modalKey = event.target.dataset.key;
                if (modalKey) {
                    appendToOutput(modalKey.toUpperCase());
                }
                comboModal.classList.add('hidden');
                mediaModal.classList.add('hidden');
            });
        });

        // Event listener for adding custom keys
        addCustomKeyBtn.addEventListener('click', () => {
            const keyName = customKeyNameInput.value.trim();
            const command = customCommandInput.value.trim();

            if (keyName && command) {
                const newKey = document.createElement('button');
                newKey.className = 'key';
                newKey.dataset.key = command;
                newKey.textContent = keyName;
                newKey.addEventListener('click', handleKeyClick);
                
                customKeysRow.appendChild(newKey);

                customKeyNameInput.value = '';
                customCommandInput.value = '';
                settingsModal.classList.add('hidden');
            }
        });

        // Close modals on click outside
        window.addEventListener('click', (event) => {
            if (event.target.classList.contains('modal')) {
                event.target.classList.add('hidden');
            }
        });

        // Copy button functionality
        copyBtn.addEventListener('click', () => {
            outputEl.select();
            document.execCommand('copy');
            messageBox.classList.remove('hidden');
            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, 2000);
        });

        // Clear button functionality
        clearBtn.addEventListener('click', () => {
            outputEl.value = '';
            activeModifiers.clear();
            document.querySelectorAll('.key-mod').forEach(btn => btn.classList.remove('active'));
            isCapsLockOn = false;
            capsLockKey.classList.remove('active');
            updateLetterKeysDisplay();
        });

        // Initialize display
        updateLetterKeysDisplay();
    </script>
</body>
</html>

